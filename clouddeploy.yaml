steps:
  - name: 'gcr.io/cloud-builders/gcloud'
    entrypoint: 'bash'
    args:
      - '-c'
      - |
        if [[ "$BRANCH_NAME" == "master" ]]
        then
          gcloud container clusters update private-cluster-0 \
          --region=us-central1 \
          --enable-master-authorized-networks \
        fi
      
  - name: 'gcr.io/cloud-builders/kubectl'
    env:
     - 'CLOUDSDK_COMPUTE_REGION=us-central1'
     - 'CLOUDSDK_CONTAINER_CLUSTER=private-cluster-0'
    args:
     - '-c'
     - |
        if [[ "$BRANCH_NAME" == "master" ]]
        then
          - 'apply'
          - '-f'
          - 'deployment.yaml'
